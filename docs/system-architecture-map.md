# Business AI Assistant - Complete System Architecture Map

## ğŸ¯ High-Level System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BUSINESS AI ASSISTANT                           â”‚
â”‚                    Multi-Tenant RAG-Powered System                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   BUSINESS PORTAL  â”‚          â”‚   PUBLIC CHAT      â”‚
        â”‚  (Authenticated)   â”‚          â”‚   (Anonymous)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Complete Technology Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            TECHNOLOGY LAYERS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ¨ FRONTEND (Not part of API, but connects to it)                     â”‚
â”‚  â”œâ”€ React / Vue / Plain HTML + JavaScript                              â”‚
â”‚  â”œâ”€ Chat Widget (embeddable)                                           â”‚
â”‚  â””â”€ Business Dashboard                                                 â”‚
â”‚                                                                         â”‚
â”‚  ğŸ”§ BACKEND FRAMEWORK                                                   â”‚
â”‚  â”œâ”€ Node.js (Runtime)                                                  â”‚
â”‚  â”œâ”€ Express.js (Web Framework)                                         â”‚
â”‚  â””â”€ JavaScript/ES6+                                                    â”‚
â”‚                                                                         â”‚
â”‚  ğŸ’¾ DATABASES                                                           â”‚
â”‚  â”œâ”€ MongoDB (User, Business, Documents metadata)                       â”‚
â”‚  â”œâ”€ ChromaDB (Vector embeddings for semantic search)                   â”‚
â”‚  â””â”€ In-Memory (Redis - optional for caching)                          â”‚
â”‚                                                                         â”‚
â”‚  ğŸ¤– AI/ML SERVICES                                                      â”‚
â”‚  â”œâ”€ OpenAI API                                                         â”‚
â”‚  â”‚   â”œâ”€ text-embedding-3-small (Embeddings)                           â”‚
â”‚  â”‚   â””â”€ gpt-3.5-turbo (Chat completions)                              â”‚
â”‚  â””â”€ Vector Search (ChromaDB)                                           â”‚
â”‚                                                                         â”‚
â”‚  ğŸ” SECURITY & MIDDLEWARE                                               â”‚
â”‚  â”œâ”€ JWT (jsonwebtoken) - Authentication                                â”‚
â”‚  â”œâ”€ bcrypt - Password hashing                                          â”‚
â”‚  â”œâ”€ Helmet - Security headers                                          â”‚
â”‚  â”œâ”€ CORS - Cross-origin control                                        â”‚
â”‚  â”œâ”€ express-rate-limit - Rate limiting                                 â”‚
â”‚  â”œâ”€ express-mongo-sanitize - NoSQL injection prevention                â”‚
â”‚  â”œâ”€ express-validator - Input validation                               â”‚
â”‚  â””â”€ xss-clean - XSS attack prevention                                  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“ FILE PROCESSING                                                     â”‚
â”‚  â”œâ”€ Multer (File uploads)                                              â”‚
â”‚  â”œâ”€ pdf-parse (PDF text extraction)                                    â”‚
â”‚  â”œâ”€ mammoth (DOCX text extraction)                                     â”‚
â”‚  â””â”€ csv-parser (CSV processing)                                        â”‚
â”‚                                                                         â”‚
â”‚  ğŸ› ï¸ UTILITIES                                                           â”‚
â”‚  â”œâ”€ dotenv (Environment variables)                                     â”‚
â”‚  â”œâ”€ Morgan/Winston (Logging)                                           â”‚
â”‚  â””â”€ Nodemon (Development)                                              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Detailed System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   CLIENTS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”‚                                                â”‚
â”‚  ğŸ‘¥ BUSINESS USERS             â”‚  ğŸ‘¤ END CUSTOMERS                              â”‚
â”‚  (Admin Dashboard)             â”‚  (Public Chat Widget)                          â”‚
â”‚  - Business Owners             â”‚  - Website Visitors                            â”‚
â”‚  - Team Members                â”‚  - No Registration                             â”‚
â”‚  - Authenticated               â”‚  - Anonymous                                   â”‚
â”‚                                â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                    â”‚
             â”‚ HTTPS                              â”‚ HTTPS
             â”‚ JWT Token                          â”‚ Session ID
             â”‚                                    â”‚
             â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ğŸ”’ SECURITY LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   CORS Filter        â”‚  â”‚   Rate Limiter       â”‚  â”‚   Helmet Headers     â”‚ â”‚
â”‚  â”‚   âœ“ Allowed origins  â”‚  â”‚   âœ“ IP-based limits  â”‚  â”‚   âœ“ XSS protection   â”‚ â”‚
â”‚  â”‚   âœ“ Credentials      â”‚  â”‚   âœ“ Per-endpoint     â”‚  â”‚   âœ“ CSP headers      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Input Validation   â”‚  â”‚   Sanitization       â”‚  â”‚   File Validation    â”‚ â”‚
â”‚  â”‚   âœ“ Schema checks    â”‚  â”‚   âœ“ NoSQL injection  â”‚  â”‚   âœ“ MIME type        â”‚ â”‚
â”‚  â”‚   âœ“ Type validation  â”‚  â”‚   âœ“ XSS cleaning     â”‚  â”‚   âœ“ File size        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ¯ EXPRESS.JS API SERVER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        AUTHENTICATION MIDDLEWARE                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  JWT Verification â†’ Business Access Check â†’ Permission Check  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                             API ROUTES                                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“Œ PUBLIC ROUTES (No Auth)                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ GET  /api/public/:businessSlug                                     â”‚   â”‚
â”‚  â”‚  â”‚       â†’ Get business info for chat widget                           â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â””â”€ POST /api/public/:businessSlug/chat                                â”‚   â”‚
â”‚  â”‚          â†’ Customer asks question (RAG)                                â”‚   â”‚
â”‚  â”‚          Security: IP-based rate limit (10/hour)                       â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  ğŸ” BUSINESS AUTH ROUTES                                               â”‚   â”‚
â”‚  â”‚  â”œâ”€ POST /api/business/register                                        â”‚   â”‚
â”‚  â”‚  â”‚       â†’ Register new business + owner                               â”‚   â”‚
â”‚  â”‚  â”‚       Security: Email validation, password strength                 â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â””â”€ POST /api/business/login                                           â”‚   â”‚
â”‚  â”‚          â†’ Business user login                                         â”‚   â”‚
â”‚  â”‚          Security: Rate limit (5 attempts/15min), bcrypt verify        â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“„ DOCUMENT ROUTES (Auth Required)                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€ POST /api/business/:businessId/documents/upload                    â”‚   â”‚
â”‚  â”‚  â”‚       â†’ Upload business document                                    â”‚   â”‚
â”‚  â”‚  â”‚       Security: JWT + Permission + File validation                  â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ GET  /api/business/:businessId/documents                           â”‚   â”‚
â”‚  â”‚  â”‚       â†’ List all business documents                                 â”‚   â”‚
â”‚  â”‚  â”‚       Security: JWT + Business access check                         â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â””â”€ DELETE /api/business/:businessId/documents/:docId                  â”‚   â”‚
â”‚  â”‚          â†’ Delete document                                             â”‚   â”‚
â”‚  â”‚          Security: JWT + Permission check + Ownership                  â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  ğŸ‘¥ TEAM ROUTES (Auth Required)                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€ POST /api/business/:businessId/team/invite                         â”‚   â”‚
â”‚  â”‚  â”‚       â†’ Invite team member                                          â”‚   â”‚
â”‚  â”‚  â”‚       Security: JWT + Admin/Owner only                              â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ GET  /api/business/:businessId/team                                â”‚   â”‚
â”‚  â”‚  â”‚       â†’ List team members                                           â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ PATCH /api/business/:businessId/team/:userId                       â”‚   â”‚
â”‚  â”‚  â”‚       â†’ Update member role/permissions                              â”‚   â”‚
â”‚  â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â””â”€ DELETE /api/business/:businessId/team/:userId                      â”‚   â”‚
â”‚  â”‚          â†’ Remove team member                                          â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“Š ANALYTICS ROUTES (Auth Required)                                   â”‚   â”‚
â”‚  â”‚  â””â”€ GET  /api/business/:businessId/analytics                           â”‚   â”‚
â”‚  â”‚          â†’ Get chat statistics and insights                            â”‚   â”‚
â”‚  â”‚          Security: JWT + Business access                               â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  âš™ï¸ SETTINGS ROUTES (Auth Required)                                    â”‚   â”‚
â”‚  â”‚  â””â”€ PATCH /api/business/:businessId/settings                           â”‚   â”‚
â”‚  â”‚          â†’ Update business/chat settings                               â”‚   â”‚
â”‚  â”‚          Security: JWT + Owner/Admin only                              â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  ğŸ¥ HEALTH CHECK                                                       â”‚   â”‚
â”‚  â”‚  â””â”€ GET  /api/health                                                   â”‚   â”‚
â”‚  â”‚          â†’ System health status                                        â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ¯ BUSINESS LOGIC LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                            CONTROLLERS                                   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ auth.controller.js       â†’ Handle registration/login                 â”‚  â”‚
â”‚  â”‚  â€¢ business.controller.js   â†’ Business CRUD operations                  â”‚  â”‚
â”‚  â”‚  â€¢ document.controller.js   â†’ Document upload/management                â”‚  â”‚
â”‚  â”‚  â€¢ publicChat.controller.js â†’ Public chat handling                      â”‚  â”‚
â”‚  â”‚  â€¢ team.controller.js       â†’ Team member management                    â”‚  â”‚
â”‚  â”‚  â€¢ analytics.controller.js  â†’ Statistics and insights                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                              SERVICES                                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ auth.service.js          â†’ JWT generation, password hashing          â”‚  â”‚
â”‚  â”‚  â€¢ embedding.service.js     â†’ OpenAI embedding creation                 â”‚  â”‚
â”‚  â”‚  â€¢ vector.service.js        â†’ ChromaDB operations                       â”‚  â”‚
â”‚  â”‚  â€¢ llm.service.js           â†’ OpenAI GPT chat completions               â”‚  â”‚
â”‚  â”‚  â€¢ fileProcessor.service.js â†’ Extract text from files                   â”‚  â”‚
â”‚  â”‚  â€¢ business.service.js      â†’ Business logic                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚                â”‚
         â–¼                â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ğŸ’¾ DATA LAYER                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          ğŸƒ MONGODB                                    â”‚    â”‚
â”‚  â”‚                     (User & Business Data)                             â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  ğŸ“¦ COLLECTIONS:                                                       â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  users                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ _id, email, password (bcrypt), fullName                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ isActive, createdAt, lastLogin                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Indexes: { email: 1 } unique                            â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  businesses                                                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ _id, businessName, businessSlug                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ businessType, industry, description                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ contact info (phone, email, address)                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ branding (logo, primaryColor)                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ chatSettings { welcomeMessage, isPublic, rateLimit }     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ createdBy, createdAt, isActive                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Indexes: { businessSlug: 1 } unique                      â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  business_members                                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ _id, userId (ref), businessId (ref)                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ role (owner/admin/manager/staff)                         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ permissions { canUpload, canDelete, canManage... }       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ joinedAt, status                                         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Indexes: { userId: 1, businessId: 1 } unique             â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  documents                                                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ _id, businessId (ref)                                    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ filename, originalName, fileType, fileSize               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ uploadedBy (ref), uploadedAt                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ chromaCollectionId, chromaIds[]                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ status (processing/completed/failed)                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Indexes: { businessId: 1 }, { uploadedAt: -1 }           â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  public_chats                                                â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ _id, businessId (ref)                                    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ sessionId, ipAddress (hashed), userAgent                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ question, answer, sources[], confidence                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ responseTime, createdAt                                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Indexes: { businessId: 1 }, { createdAt: -1 }            â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          ğŸ”· CHROMADB                                   â”‚    â”‚
â”‚  â”‚                    (Vector Embeddings Storage)                         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  ğŸ“¦ COLLECTIONS (One per Business):                                   â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  business_507f1f77bcf86cd799439011                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ id: "doc1_chunk1"                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ embedding: [0.234, -0.123, 0.567, ... ] (1536 dims)     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ document: "We're open Monday-Friday 9am-5pm..."          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ metadata: {                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚      businessId, documentId, filename,                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚      fileType, uploadedAt, chunkIndex                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    }                                                          â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  business_507f191e810c19729de860ea                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ (Another business's documents)                           â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  ğŸ” OPERATIONS:                                                        â”‚    â”‚
â”‚  â”‚  â€¢ add() - Store document chunks with embeddings                      â”‚    â”‚
â”‚  â”‚  â€¢ query() - Semantic similarity search                               â”‚    â”‚
â”‚  â”‚  â€¢ delete() - Remove document chunks                                  â”‚    â”‚
â”‚  â”‚  â€¢ get() - Retrieve specific chunks                                   â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ¤– EXTERNAL AI SERVICES                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                          OPENAI API                                    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  ğŸ“Œ EMBEDDINGS API                                                     â”‚    â”‚
â”‚  â”‚  Endpoint: https://api.openai.com/v1/embeddings                       â”‚    â”‚
â”‚  â”‚  Model: text-embedding-3-small                                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ Input: Text string                                                â”‚    â”‚
â”‚  â”‚  â”œâ”€ Output: Array of 1536 numbers (vector)                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ Cost: ~$0.00002 per embedding                                     â”‚    â”‚
â”‚  â”‚  â””â”€ Use: Convert text to semantic vectors for search                  â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â”‚  ğŸ¤– CHAT COMPLETIONS API                                              â”‚    â”‚
â”‚  â”‚  Endpoint: https://api.openai.com/v1/chat/completions                 â”‚    â”‚
â”‚  â”‚  Model: gpt-3.5-turbo                                                 â”‚    â”‚
â”‚  â”‚  â”œâ”€ Input: System prompt + User question + Context                    â”‚    â”‚
â”‚  â”‚  â”œâ”€ Output: Natural language answer                                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ Cost: ~$0.0005 per question                                       â”‚    â”‚
â”‚  â”‚  â””â”€ Use: Generate intelligent answers based on context                â”‚    â”‚
â”‚  â”‚                                                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Data Flow Diagrams

### Flow 1: Business Registration & Document Upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BUSINESS REGISTRATION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Business Owner
    â”‚
    â”‚ 1. POST /api/business/register
    â”‚    { email, password, businessName, ... }
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ SECURITY CHECKS            â”‚
â”‚  â”œâ”€ Rate limit (5/15min)       â”‚
â”‚  â”œâ”€ Email format validation    â”‚
â”‚  â”œâ”€ Password strength check    â”‚
â”‚  â””â”€ Input sanitization         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ âœ“ Passed
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” AUTHENTICATION SERVICE     â”‚
â”‚  â”œâ”€ Hash password (bcrypt)     â”‚
â”‚  â”œâ”€ Generate user ID           â”‚
â”‚  â””â”€ Generate business ID       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ SAVE TO MONGODB            â”‚
â”‚  â”œâ”€ Create user record         â”‚
â”‚  â”œâ”€ Create business record     â”‚
â”‚  â””â”€ Create member record       â”‚
â”‚      (owner role)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”· INITIALIZE CHROMADB        â”‚
â”‚  â””â”€ Create collection:         â”‚
â”‚      "business_[businessId]"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ« GENERATE JWT TOKEN         â”‚
â”‚  â””â”€ Include: userId,           â”‚
â”‚      businessId, role          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    Return to Business Owner:
    { token, user, business }


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DOCUMENT UPLOAD FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Business User
    â”‚
    â”‚ 2. POST /api/business/:id/documents/upload
    â”‚    Authorization: Bearer [token]
    â”‚    Content-Type: multipart/form-data
    â”‚    File: services.pdf
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ SECURITY CHECKS            â”‚
â”‚  â”œâ”€ JWT verification           â”‚
â”‚  â”œâ”€ Business access check      â”‚
â”‚  â”œâ”€ Permission check           â”‚
â”‚  â”œâ”€ File type validation       â”‚
â”‚  â”‚   (PDF/TXT/DOCX/CSV/MD/JSON)â”‚
â”‚  â”œâ”€ File size check (<10MB)    â”‚
â”‚  â”œâ”€ MIME type verification     â”‚
â”‚  â””â”€ Rate limit (5 uploads/hour)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ âœ“ Passed
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ FILE PROCESSING            â”‚
â”‚  â”œâ”€ Save to /uploads temp      â”‚
â”‚  â”œâ”€ Extract text content       â”‚
â”‚  â”‚   â€¢ PDF â†’ pdf-parse         â”‚
â”‚  â”‚   â€¢ DOCX â†’ mammoth          â”‚
â”‚  â”‚   â€¢ TXT â†’ fs.readFile       â”‚
â”‚  â”‚   â€¢ CSV â†’ csv-parser        â”‚
â”‚  â””â”€ Validate text extracted    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Text: "We're open 9-5..."
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ SAVE METADATA TO MONGODB   â”‚
â”‚  â””â”€ Create document record     â”‚
â”‚      status: "processing"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– CREATE EMBEDDING           â”‚
â”‚  â”œâ”€ Call OpenAI API            â”‚
â”‚  â”‚   POST /v1/embeddings       â”‚
â”‚  â”‚   { input: text }           â”‚
â”‚  â”œâ”€ Receive 1536-dim vector    â”‚
â”‚  â””â”€ Cost: $0.00002             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ embedding: [0.234, -0.123, ...]
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”· STORE IN CHROMADB          â”‚
â”‚  â”œâ”€ Get business collection    â”‚
â”‚  â”œâ”€ Add document:              â”‚
â”‚  â”‚   { id, embedding,          â”‚
â”‚  â”‚     document: text,         â”‚
â”‚  â”‚     metadata }              â”‚
â”‚  â””â”€ Cost: FREE                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ UPDATE MONGODB             â”‚
â”‚  â””â”€ Update document:           â”‚
â”‚      status: "completed"       â”‚
â”‚      chromaIds: [...]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—‘ï¸ CLEANUP                    â”‚
â”‚  â””â”€ Delete temp file           â”‚
â”‚      from /uploads             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    Return to Business User:
    { success, document }
```

### Flow 2: Public Customer Chat (RAG)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PUBLIC CHAT FLOW (RAG)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Customer (Anonymous)
    â”‚
    â”‚ 3. POST /api/public/luxury-salon/chat
    â”‚    { question: "How much is a haircut?",
    â”‚      sessionId: "sess_xyz123" }
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”’ SECURITY CHECKS            â”‚
â”‚  â”œâ”€ Rate limit (10/hour by IP)â”‚
â”‚  â”œâ”€ Input validation           â”‚
â”‚  â”‚   â€¢ Max 500 chars           â”‚
â”‚  â”‚   â€¢ Non-empty               â”‚
â”‚  â”œâ”€ XSS sanitization           â”‚
â”‚  â””â”€ Business exists & active   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ âœ“ Passed
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– CREATE QUESTION EMBEDDING  â”‚
â”‚  â”œâ”€ Call OpenAI API            â”‚
â”‚  â”‚   POST /v1/embeddings       â”‚
â”‚  â”‚   { input: question }       â”‚
â”‚  â”œâ”€ Receive vector             â”‚
â”‚  â””â”€ Cost: $0.00002             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ queryEmbedding: [0.231, -0.119, ...]
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”· SEARCH CHROMADB (RAG!)     â”‚
â”‚  â”œâ”€ Get business collection    â”‚
â”‚  â”œâ”€ Query similar vectors      â”‚
â”‚  â”‚   collection.query({        â”‚
â”‚  â”‚     queryEmbeddings,        â”‚
â”‚  â”‚     nResults: 3             â”‚
â”‚  â”‚   })                        â”‚
â”‚  â”œâ”€ Cosine similarity search   â”‚
â”‚  â””â”€ Return top 3 matches       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Found:
             â”‚ 1. "Haircut: $50..." (score: 0.95)
             â”‚ 2. "Services include..." (score: 0.82)
             â”‚ 3. "We're open..." (score: 0.65)
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ BUILD PROMPT               â”‚
â”‚  â””â”€ Construct:                 â”‚
â”‚      System: "You are helpful  â”‚
â”‚               assistant for    â”‚
â”‚               Luxury Salon"    â”‚
â”‚      Context: [Retrieved docs] â”‚
â”‚      Question: [User question] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– CALL OPENAI GPT            â”‚
â”‚  â”œâ”€ POST /v1/chat/completions  â”‚
â”‚  â”œâ”€ Model: gpt-3.5-turbo       â”‚
â”‚  â”œâ”€ Send prompt with context   â”‚
â”‚  â”œâ”€ Receive answer             â”‚
â”‚  â””â”€ Cost: $0.0005              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ answer: "Our haircut service costs $50..."
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¾ LOG CHAT                   â”‚
â”‚  â””â”€ Save to public_chats       â”‚
â”‚      collection in MongoDB     â”‚
â”‚      (for analytics)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    Return to Customer:
    {
      answer: "Our haircut...",
      sources: ["services.pdf"],
      confidence: 0.95
    }
    
    Total Cost: ~$0.00052
    Total Time: ~1-2 seconds
```

---

## ğŸ” Security Architecture Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SECURITY LAYERS & MEASURES                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: NETWORK SECURITY                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸŒ HTTPS/TLS Encryption                                                        â”‚
â”‚  â”œâ”€ All traffic encrypted                                                       â”‚
â”‚  â”œâ”€ SSL certificates (Let's Encrypt)                                            â”‚
â”‚  â””â”€ Secure WebSocket connections                                                â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ”’ CORS (Cross-Origin Resource Sharing)                                        â”‚
â”‚  â”œâ”€ Whitelist allowed origins                                                   â”‚
â”‚  â”œâ”€ Control methods (GET, POST, DELETE)                                         â”‚
â”‚  â”œâ”€ Credential handling                                                         â”‚
â”‚  â””â”€ Preflight request validation                                                â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ›¡ï¸ Helmet.js (Security Headers)                                                â”‚
â”‚  â”œâ”€ X-Frame-Options: DENY                                                       â”‚
â”‚  â”œâ”€ X-Content-Type-Options: nosniff                                             â”‚
â”‚  â”œâ”€ X-XSS-Protection: 1; mode=block                                             â”‚
â”‚  â”œâ”€ Strict-Transport-Security                                                   â”‚
â”‚  â””â”€ Content-Security-Policy                                                     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 2: RATE LIMITING & DDOS PROTECTION                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â±ï¸ General API Rate Limit                                                      â”‚
â”‚  â””â”€ 100 requests / 15 minutes per IP                                            â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’¬ Public Chat Rate Limit                                                      â”‚
â”‚  â””â”€ 10 questions / hour per IP address                                          â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ” Auth Endpoints Rate Limit (Brute Force Protection)                          â”‚
â”‚  â”œâ”€ Login: 5 attempts / 15 minutes                                              â”‚
â”‚  â”œâ”€ Register: 3 attempts / hour                                                 â”‚
â”‚  â””â”€ Password reset: 3 attempts / hour                                           â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“¤ Upload Rate Limit                                                           â”‚
â”‚  â””â”€ 5 uploads / hour per user                                                   â”‚
â”‚                                                                                 â”‚
â”‚  ğŸš« Response on Limit Exceeded                                                  â”‚
â”‚  â””â”€ HTTP 429 Too Many Requests                                                  â”‚
â”‚      { error: "Rate limit exceeded", retryAfter: 900 }                          â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 3: AUTHENTICATION & AUTHORIZATION                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ« JWT (JSON Web Tokens)                                                       â”‚
â”‚  â”œâ”€ Algorithm: HS256                                                            â”‚
â”‚  â”œâ”€ Expiration: 7 days                                                          â”‚
â”‚  â”œâ”€ Payload: { userId, businessId, role, permissions }                          â”‚
â”‚  â”œâ”€ Secret: Strong random string (env variable)                                 â”‚
â”‚  â””â”€ Verification on every protected route                                       â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ”‘ Password Security                                                           â”‚
â”‚  â”œâ”€ Hashing: bcrypt with salt rounds = 12                                       â”‚
â”‚  â”œâ”€ Minimum requirements:                                                       â”‚
â”‚  â”‚   â€¢ 8+ characters                                                            â”‚
â”‚  â”‚   â€¢ Uppercase + lowercase                                                    â”‚
â”‚  â”‚   â€¢ At least 1 number                                                        â”‚
â”‚  â”‚   â€¢ At least 1 special char (optional)                                       â”‚
â”‚  â””â”€ Never store plain text passwords                                            â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ‘¤ Session Management                                                          â”‚
â”‚  â”œâ”€ Public users: sessionId (UUID)                                              â”‚
â”‚  â”œâ”€ Business users: JWT token                                                   â”‚
â”‚  â””â”€ Token refresh mechanism (optional)                                          â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ” Permission-Based Access Control (PBAC)                                      â”‚
â”‚  â”œâ”€ Check user role (owner/admin/manager/staff)                                 â”‚
â”‚  â”œâ”€ Verify specific permissions:                                                â”‚
â”‚  â”‚   â€¢ canUploadDocuments                                                       â”‚
â”‚  â”‚   â€¢ canDeleteDocuments                                                       â”‚
â”‚  â”‚   â€¢ canManageTeam                                                            â”‚
â”‚  â”‚   â€¢ canViewAnalytics                                                         â”‚
â”‚  â”‚   â€¢ canManageSettings                                                        â”‚
â”‚  â””â”€ Deny if insufficient permissions                                            â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 4: INPUT VALIDATION & SANITIZATION                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  âœ… Request Validation (express-validator)                                      â”‚
â”‚  â”œâ”€ Email format validation                                                     â”‚
â”‚  â”œâ”€ Password strength validation                                                â”‚
â”‚  â”œâ”€ Required fields check                                                       â”‚
â”‚  â”œâ”€ Type validation (string/number/boolean)                                     â”‚
â”‚  â”œâ”€ Length constraints                                                          â”‚
â”‚  â””â”€ Custom validation rules                                                     â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ§¹ Input Sanitization                                                          â”‚
â”‚  â”œâ”€ Trim whitespace                                                             â”‚
â”‚  â”œâ”€ Escape HTML entities                                                        â”‚
â”‚  â”œâ”€ Remove script tags                                                          â”‚
â”‚  â””â”€ Normalize email addresses                                                   â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’‰ NoSQL Injection Prevention (express-mongo-sanitize)                         â”‚
â”‚  â”œâ”€ Remove $ and . from input                                                   â”‚
â”‚  â”œâ”€ Prevent MongoDB operator injection                                          â”‚
â”‚  â””â”€ Example blocked: { "$gt": "" }                                              â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ”ª XSS Prevention (xss-clean)                                                  â”‚
â”‚  â”œâ”€ Clean user input from malicious scripts                                     â”‚
â”‚  â”œâ”€ Remove <script> tags                                                        â”‚
â”‚  â”œâ”€ Sanitize HTML attributes                                                    â”‚
â”‚  â””â”€ Example blocked: <img src=x onerror="alert('XSS')">                         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 5: FILE UPLOAD SECURITY                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ“„ File Type Validation (Multer)                                               â”‚
â”‚  â”œâ”€ Allowed extensions: .pdf .txt .docx .csv .md .json                          â”‚
â”‚  â”œâ”€ MIME type verification:                                                     â”‚
â”‚  â”‚   â€¢ application/pdf                                                          â”‚
â”‚  â”‚   â€¢ text/plain                                                               â”‚
â”‚  â”‚   â€¢ application/vnd.openxml... (docx)                                        â”‚
â”‚  â”‚   â€¢ text/csv                                                                 â”‚
â”‚  â”‚   â€¢ text/markdown                                                            â”‚
â”‚  â”‚   â€¢ application/json                                                         â”‚
â”‚  â”œâ”€ Double check: MIME + extension match                                        â”‚
â”‚  â””â”€ Reject if mismatch (prevent spoofing)                                       â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“ File Size Limits                                                            â”‚
â”‚  â”œâ”€ Maximum: 10MB per file                                                      â”‚
â”‚  â”œâ”€ Total upload limit per business (optional)                                  â”‚
â”‚  â””â”€ HTTP 413 Payload Too Large if exceeded                                      â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ—‚ï¸ File Storage Security                                                       â”‚
â”‚  â”œâ”€ Temporary storage in /uploads                                               â”‚
â”‚  â”œâ”€ Generate random filenames (prevent path traversal)                          â”‚
â”‚  â”œâ”€ Delete temp files after processing                                          â”‚
â”‚  â”œâ”€ No execution permissions on upload directory                                â”‚
â”‚  â””â”€ Optional: Scan with antivirus (ClamAV)                                      â”‚
â”‚                                                                                 â”‚
â”‚  ğŸš« Blocked File Types                                                          â”‚
â”‚  â””â”€ .exe .sh .bat .cmd .scr .dll .jar .zip                                      â”‚
â”‚      (Executables and potentially harmful files)                                â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 6: DATA ISOLATION & PRIVACY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ¢ Business Data Isolation                                                     â”‚
â”‚  â”œâ”€ Every query filtered by businessId                                          â”‚
â”‚  â”œâ”€ Separate ChromaDB collections per business                                  â”‚
â”‚  â”œâ”€ Validate user belongs to business before access                             â”‚
â”‚  â””â”€ Cross-business access = immediate 403 Forbidden                             â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ”’ Database Security                                                           â”‚
â”‚  â”œâ”€ MongoDB authentication enabled                                              â”‚
â”‚  â”œâ”€ Least privilege access (app user can't drop DB)                             â”‚
â”‚  â”œâ”€ IP whitelist for database access                                            â”‚
â”‚  â””â”€ Encrypted connections (TLS)                                                 â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ•µï¸ Customer Privacy (Public Chat)                                              â”‚
â”‚  â”œâ”€ No PII collection                                                           â”‚
â”‚  â”œâ”€ IP addresses hashed before storage                                          â”‚
â”‚  â”œâ”€ SessionId = random UUID (not trackable)                                     â”‚
â”‚  â”œâ”€ No email/name required                                                      â”‚
â”‚  â””â”€ GDPR compliant (anonymous by design)                                        â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ” Sensitive Data Handling                                                     â”‚
â”‚  â”œâ”€ Passwords: bcrypt hashed, never logged                                      â”‚
â”‚  â”œâ”€ JWT secrets: environment variables                                          â”‚
â”‚  â”œâ”€ OpenAI keys: environment variables, never exposed                           â”‚
â”‚  â””â”€ Credit cards: Not stored (use Stripe if needed)                             â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 7: LOGGING & MONITORING                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ“ Security Event Logging                                                      â”‚
â”‚  â”œâ”€ Failed login attempts                                                       â”‚
â”‚  â”œâ”€ Rate limit violations                                                       â”‚
â”‚  â”œâ”€ Permission denied errors                                                    â”‚
â”‚  â”œâ”€ File upload rejections                                                      â”‚
â”‚  â”œâ”€ Cross-business access attempts                                              â”‚
â”‚  â””â”€ Suspicious patterns (multiple IPs same user)                                â”‚
â”‚                                                                                 â”‚
â”‚  ğŸš¨ Alert System (Future)                                                       â”‚
â”‚  â”œâ”€ Email on multiple failed logins                                             â”‚
â”‚  â”œâ”€ Slack notification on security events                                       â”‚
â”‚  â””â”€ Dashboard for security metrics                                              â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“Š Audit Trail                                                                 â”‚
â”‚  â”œâ”€ Document uploads/deletes                                                    â”‚
â”‚  â”œâ”€ Team member additions/removals                                              â”‚
â”‚  â”œâ”€ Permission changes                                                          â”‚
â”‚  â””â”€ Settings modifications                                                      â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ” What NOT to Log                                                             â”‚
â”‚  â”œâ”€ âŒ Passwords (hashed or plain)                                              â”‚
â”‚  â”œâ”€ âŒ JWT tokens                                                                â”‚
â”‚  â”œâ”€ âŒ API keys                                                                  â”‚
â”‚  â”œâ”€ âŒ Full credit card numbers                                                  â”‚
â”‚  â””â”€ âŒ Personal identifiable information (PII)                                   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 8: ERROR HANDLING                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  âœ… Production Error Responses                                                  â”‚
â”‚  â”œâ”€ Generic messages (don't expose internals)                                   â”‚
â”‚  â”œâ”€ Example: "An error occurred" vs "SQL syntax error..."                       â”‚
â”‚  â””â”€ Log details server-side, show generic to user                               â”‚
â”‚                                                                                 â”‚
â”‚  âŒ Development Error Responses                                                 â”‚
â”‚  â””â”€ Detailed stack traces (only in NODE_ENV=development)                        â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ”’ Security Error Codes                                                        â”‚
â”‚  â”œâ”€ 401 Unauthorized - Missing/invalid auth                                     â”‚
â”‚  â”œâ”€ 403 Forbidden - Insufficient permissions                                    â”‚
â”‚  â”œâ”€ 429 Too Many Requests - Rate limit exceeded                                 â”‚
â”‚  â””â”€ 500 Internal Server Error - Generic failure                                 â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance & Scalability Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERFORMANCE OPTIMIZATION POINTS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  âš¡ Database Optimization                                                        â”‚
â”‚  â”œâ”€ MongoDB Indexes:                                                            â”‚
â”‚  â”‚   â€¢ users.email (unique)                                                     â”‚
â”‚  â”‚   â€¢ businesses.businessSlug (unique)                                         â”‚
â”‚  â”‚   â€¢ business_members.userId + businessId (compound, unique)                  â”‚
â”‚  â”‚   â€¢ documents.businessId                                                     â”‚
â”‚  â”‚   â€¢ public_chats.businessId + createdAt                                      â”‚
â”‚  â”œâ”€ Connection pooling (max 10 connections)                                     â”‚
â”‚  â””â”€ Query projection (select only needed fields)                                â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ”· ChromaDB Optimization                                                       â”‚
â”‚  â”œâ”€ Separate collections per business (isolation + speed)                       â”‚
â”‚  â”œâ”€ Batch operations when possible                                              â”‚
â”‚  â””â”€ Local storage (no network latency)                                          â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’¾ Caching Strategy (Optional - Phase 2)                                       â”‚
â”‚  â”œâ”€ Redis for frequent queries                                                  â”‚
â”‚  â”œâ”€ Cache business info (1 hour TTL)                                            â”‚
â”‚  â”œâ”€ Cache common questions/answers (30 min TTL)                                 â”‚
â”‚  â””â”€ Invalidate on document upload                                               â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ—œï¸ Compression                                                                 â”‚
â”‚  â”œâ”€ Gzip middleware for responses                                               â”‚
â”‚  â””â”€ Reduce payload sizes by 70-80%                                              â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“Š Response Time Targets                                                       â”‚
â”‚  â”œâ”€ Public chat: < 2 seconds                                                    â”‚
â”‚  â”œâ”€ Document upload: < 10 seconds                                               â”‚
â”‚  â”œâ”€ Auth endpoints: < 500ms                                                     â”‚
â”‚  â””â”€ List operations: < 300ms                                                    â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ“ˆ Scalability Strategy                                                        â”‚
â”‚  â”œâ”€ Horizontal scaling: Multiple API instances                                  â”‚
â”‚  â”œâ”€ Load balancer (NGINX/AWS ALB)                                               â”‚
â”‚  â”œâ”€ Stateless design (no in-memory sessions)                                    â”‚
â”‚  â””â”€ Database sharding (if needed for millions of businesses)                    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Cost Breakdown Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          COST ANALYSIS                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  ğŸ’µ MONTHLY COSTS (1 Business, 1,000 Customer Chats)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Service              â”‚  Usage          â”‚  Cost        â”‚  Notes         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  MongoDB Atlas        â”‚  < 512MB        â”‚  $0.00       â”‚  Free tier    â”‚    â”‚
â”‚  â”‚  ChromaDB             â”‚  Local          â”‚  $0.00       â”‚  Self-hosted  â”‚    â”‚
â”‚  â”‚  OpenAI Embeddings    â”‚  1,000 calls    â”‚  $0.02       â”‚  Upload+query â”‚    â”‚
â”‚  â”‚  OpenAI GPT-3.5       â”‚  1,000 calls    â”‚  $0.50       â”‚  Answers      â”‚    â”‚
â”‚  â”‚  Hosting (Railway)    â”‚  500 hrs        â”‚  $0.00       â”‚  Free tier    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  TOTAL PER BUSINESS   â”‚                 â”‚  $0.52/mo    â”‚               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ’° SCALING COSTS (100 Businesses, 100,000 Total Chats)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Service              â”‚  Usage          â”‚  Cost        â”‚  Notes         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  MongoDB Atlas        â”‚  ~500MB         â”‚  $0.00       â”‚  Still free!  â”‚    â”‚
â”‚  â”‚  ChromaDB             â”‚  ~2GB storage   â”‚  $0.00       â”‚  Local SSD    â”‚    â”‚
â”‚  â”‚  OpenAI Embeddings    â”‚  100k calls     â”‚  $2.00       â”‚  Scaled       â”‚    â”‚
â”‚  â”‚  OpenAI GPT-3.5       â”‚  100k calls     â”‚  $50.00      â”‚  Main cost    â”‚    â”‚
â”‚  â”‚  Hosting (Render)     â”‚  Upgraded       â”‚  $7.00       â”‚  Paid tier    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  TOTAL                â”‚                 â”‚  $59/mo      â”‚  ~$0.59/biz   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                 â”‚
â”‚  ğŸ¯ COST OPTIMIZATION TIPS                                                      â”‚
â”‚  â”œâ”€ Use GPT-3.5-turbo (10x cheaper than GPT-4)                                  â”‚
â”‚  â”œâ”€ Cache frequent questions (reduce API calls)                                 â”‚
â”‚  â”œâ”€ Batch embeddings when possible                                              â”‚
â”‚  â”œâ”€ Set max_tokens to reasonable limit (300-500)                                â”‚
â”‚  â””â”€ Monitor usage with OpenAI dashboard                                         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PRODUCTION DEPLOYMENT                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   DOMAIN     â”‚
                              â”‚  DNS (A/AAAA)â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   LOAD BALANCER        â”‚
                         â”‚   (NGINX / AWS ALB)    â”‚
                         â”‚   â”œâ”€ SSL Termination   â”‚
                         â”‚   â”œâ”€ Rate limiting     â”‚
                         â”‚   â””â”€ Health checks     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼              â–¼              â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  API Server  â”‚ â”‚  API Server  â”‚ â”‚  API Server  â”‚
          â”‚  Instance 1  â”‚ â”‚  Instance 2  â”‚ â”‚  Instance N  â”‚
          â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
          â”‚  Express.js  â”‚ â”‚  Express.js  â”‚ â”‚  Express.js  â”‚
          â”‚  Node.js     â”‚ â”‚  Node.js     â”‚ â”‚  Node.js     â”‚
          â”‚  ChromaDB    â”‚ â”‚  ChromaDB    â”‚ â”‚  ChromaDB    â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                â”‚                â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼             â–¼             â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   MongoDB    â”‚  â”‚   OpenAI     â”‚  â”‚   Logging    â”‚
          â”‚   Atlas      â”‚  â”‚   API        â”‚  â”‚   Service    â”‚
          â”‚   (Cloud)    â”‚  â”‚              â”‚  â”‚   (Optional) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“¦ HOSTING OPTIONS (Recommended):

Option 1: Railway (Easiest)
â”œâ”€ Auto-deploy from GitHub
â”œâ”€ Free SSL certificates
â”œâ”€ MongoDB add-on available
â”œâ”€ $0-$5/month to start
â””â”€ Good for MVP

Option 2: Render
â”œâ”€ Similar to Railway
â”œâ”€ Better free tier (750hrs/mo)
â”œâ”€ PostgreSQL + MongoDB available
â””â”€ Easy scaling

Option 3: AWS (Advanced)
â”œâ”€ EC2 instances
â”œâ”€ RDS/DocumentDB for MongoDB
â”œâ”€ ALB for load balancing
â”œâ”€ Most flexible
â””â”€ Higher cost & complexity

Option 4: DigitalOcean
â”œâ”€ Droplets (VMs)
â”œâ”€ Managed MongoDB
â”œâ”€ Load Balancer
â””â”€ Mid-range pricing
```

---

## ğŸ“ Complete File Structure

```
business-ai-assistant/
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js          # MongoDB connection & setup
â”‚   â”‚   â”œâ”€â”€ chromadb.js          # ChromaDB client initialization
â”‚   â”‚   â”œâ”€â”€ openai.js            # OpenAI client setup
â”‚   â”‚   â””â”€â”€ constants.js         # App constants (roles, file types, etc.)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                  # Mongoose schemas
â”‚   â”‚   â”œâ”€â”€ User.js              # User model
â”‚   â”‚   â”œâ”€â”€ Business.js          # Business model
â”‚   â”‚   â”œâ”€â”€ BusinessMember.js    # Junction table for users-businesses
â”‚   â”‚   â”œâ”€â”€ Document.js          # Document metadata model
â”‚   â”‚   â””â”€â”€ PublicChat.js        # Public chat logs model
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js              # JWT verification
â”‚   â”‚   â”œâ”€â”€ businessAccess.js    # Check business membership
â”‚   â”‚   â”œâ”€â”€ permissions.js       # Check specific permissions
â”‚   â”‚   â”œâ”€â”€ validation.js        # Input validation middleware
â”‚   â”‚   â”œâ”€â”€ fileUpload.js        # Multer configuration
â”‚   â”‚   â”œâ”€â”€ rateLimiter.js       # Rate limiting configs
â”‚   â”‚   â”œâ”€â”€ errorHandler.js      # Global error handler
â”‚   â”‚   â””â”€â”€ logger.js            # Request logging middleware
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ public.routes.js     # Public chat routes (no auth)
â”‚   â”‚   â”œâ”€â”€ auth.routes.js       # Business registration/login
â”‚   â”‚   â”œâ”€â”€ business.routes.js   # Business management
â”‚   â”‚   â”œâ”€â”€ document.routes.js   # Document operations
â”‚   â”‚   â”œâ”€â”€ team.routes.js       # Team member management
â”‚   â”‚   â”œâ”€â”€ analytics.routes.js  # Analytics and stats
â”‚   â”‚   â””â”€â”€ health.routes.js     # Health check endpoint
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/             # Route handlers
â”‚   â”‚   â”œâ”€â”€ auth.controller.js
â”‚   â”‚   â”œâ”€â”€ business.controller.js
â”‚   â”‚   â”œâ”€â”€ document.controller.js
â”‚   â”‚   â”œâ”€â”€ publicChat.controller.js
â”‚   â”‚   â”œâ”€â”€ team.controller.js
â”‚   â”‚   â””â”€â”€ analytics.controller.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # Business logic
â”‚   â”‚   â”œâ”€â”€ auth.service.js      # JWT, password hashing
â”‚   â”‚   â”œâ”€â”€ embedding.service.js # OpenAI embeddings
â”‚   â”‚   â”œâ”€â”€ vector.service.js    # ChromaDB operations
â”‚   â”‚   â”œâ”€â”€ llm.service.js       # OpenAI GPT operations
â”‚   â”‚   â”œâ”€â”€ fileProcessor.service.js  # Text extraction from files
â”‚   â”‚   â”œâ”€â”€ business.service.js  # Business operations
â”‚   â”‚   â”œâ”€â”€ chat.service.js      # RAG chat logic
â”‚   â”‚   â””â”€â”€ analytics.service.js # Stats calculations
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ helpers.js           # Utility functions
â”‚   â”‚   â”œâ”€â”€ validators.js        # Custom validators
â”‚   â”‚   â”œâ”€â”€ roles.js             # Role definitions & permissions
â”‚   â”‚   â””â”€â”€ logger.js            # Winston logger setup
â”‚   â”‚
â”‚   â””â”€â”€ types/                   # TypeScript types (if using TS)
â”‚       â””â”€â”€ index.d.ts
â”‚
â”œâ”€â”€ uploads/                     # Temporary file storage (gitignored)
â”œâ”€â”€ chroma_data/                 # ChromaDB storage (gitignored)
â”œâ”€â”€ logs/                        # Application logs (gitignored)
â”‚
â”œâ”€â”€ tests/                       # Test files
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”‚
â”œâ”€â”€ .env                         # Environment variables (gitignored)
â”œâ”€â”€ .env.example                 # Example env file
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ server.js                    # Main entry point
â”œâ”€â”€ README.md
â””â”€â”€ ARCHITECTURE.md              # This document!
```

---

## ğŸ¯ Quick Reference: Key Endpoints

```
PUBLIC ENDPOINTS (No Authentication)
â”œâ”€ GET  /api/public/:businessSlug              â†’ Get business info
â””â”€ POST /api/public/:businessSlug/chat         â†’ Ask question (RAG)

AUTHENTICATION
â”œâ”€ POST /api/business/register                 â†’ Register business + owner
â””â”€ POST /api/business/login                    â†’ Login

BUSINESS MANAGEMENT (JWT Required)
â”œâ”€ GET    /api/business/:businessId            â†’ Get business details
â”œâ”€ PATCH  /api/business/:businessId/settings   â†’ Update settings
â””â”€ DELETE /api/business/:businessId            â†’ Delete business

DOCUMENTS (JWT + Permissions Required)
â”œâ”€ POST   /api/business/:businessId/documents/upload  â†’ Upload doc
â”œâ”€ GET    /api/business/:businessId/documents         â†’ List docs
â”œâ”€ GET    /api/business/:businessId/documents/:docId  â†’ Get doc details
â””â”€ DELETE /api/business/:businessId/documents/:docId  â†’ Delete doc

TEAM MANAGEMENT (JWT + Admin Required)
â”œâ”€ POST   /api/business/:businessId/team/invite    â†’ Invite member
â”œâ”€ GET    /api/business/:businessId/team           â†’ List members
â”œâ”€ PATCH  /api/business/:businessId/team/:userId   â†’ Update role
â””â”€ DELETE /api/business/:businessId/team/:userId   â†’ Remove member

ANALYTICS (JWT Required)
â””â”€ GET /api/business/:businessId/analytics     â†’ Get chat stats

HEALTH
â””â”€ GET /api/health                             â†’ System status
```

---

## ğŸ“‹ Environment Variables Reference

```bash
# Server Configuration
NODE_ENV=production                    # development | production
PORT=3000                              # API port
API_URL=https://api.yourdomain.com     # Public API URL

# Database
MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/dbname
MONGODB_MAX_POOL_SIZE=10

# JWT
JWT_SECRET=your-super-secret-key-min-32-chars-long
JWT_EXPIRE=7d

# OpenAI
OPENAI_API_KEY=sk-your-openai-api-key-here
OPENAI_ORG_ID=org-your-org-id          # Optional

# Security
BCRYPT_ROUNDS=12
ALLOWED_ORIGINS=https://yourdomain.com,https://admin.yourdomain.com

# File Upload
MAX_FILE_SIZE=10485760                 # 10MB in bytes
UPLOAD_PATH=./uploads
ALLOWED_FILE_TYPES=pdf,txt,docx,csv,md,json

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000            # 15 minutes
RATE_LIMIT_MAX_REQUESTS=100
PUBLIC_CHAT_RATE_LIMIT=10              # Per hour per IP

# Logging
LOG_LEVEL=info                         # error | warn | info | debug
LOG_FILE=./logs/app.log

# Feature Flags (Optional)
ENABLE_ANALYTICS=true
ENABLE_EMAIL_INVITES=false
ENABLE_CACHING=false
```

---

## ğŸ“ Summary

This system is:
- âœ… **Secure** - Multiple layers of security
- âœ… **Scalable** - Can handle growth from 1 to 10,000+ businesses
- âœ… **Cost-effective** - ~$0.50/business/month for 1,000 chats
- âœ… **Privacy-focused** - Anonymous customer chats, GDPR compliant
- âœ… **Developer-friendly** - Clear structure, well-documented
- âœ… **Production-ready** - Error handling, logging, monitoring

**Total Technologies Used:** 20+
**Total API Endpoints:** 15+
**Security Measures:** 30+
**Estimated Response Time:** 1-2 seconds per chat
**Estimated Uptime:** 99.9%

---

**Last Updated:** December 29, 2024
**Version:** 1.0
**Author:** System Architecture Documentation
